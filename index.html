<!DOCTYPE html>
<html lang="uk">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="./img/favicon.ico" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@duetds/date-picker@1.4.0/dist/duet/themes/default.css" />
	<link rel="stylesheet" href="app.css">
	<script type="module" src="https://cdn.jsdelivr.net/npm/@duetds/date-picker@1.4.0/dist/duet/duet.esm.js"></script>
	<script nomodule src="https://cdn.jsdelivr.net/npm/@duetds/date-picker@1.4.0/dist/duet/duet.js"></script>
	<title>Підпис клієнта</title>
</head>

<body class="active-1">
	<header class="header">
		<div class="container">
			<a href="/" title="Мій Банк. Моя країна" class="logo-link">
				<svg class="logo" viewBox="0 0 185 90" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M184 45.5H0V91H184V45.5Z" fill="#DCE123" />
					<path d="M184 0H0V45.5H184V0Z" fill="#00503C" />
					<path
						d="M23.9549 63.3906H25.1021L27.2578 68.504L29.5131 63.3906H30.6603L32.025 71.4357H30.4158L29.6852 66.4778L27.5023 71.4357H26.9679L24.8848 66.4778L24.0545 71.4357H22.4453L23.9549 63.3906Z"
						fill="black" />
					<path d="M35.2882 63.3906V71.4357H33.7031V63.3906H35.2882Z" fill="black" />
					<path
						d="M38.9678 63.3904V68.7458L43.4271 63.3904H44.5472V71.4355H42.9621V66.0562L38.5029 71.4355H37.3828V63.3904H38.9678ZM39.8706 60.8203C40.1272 61.4957 40.8095 61.5196 40.9695 61.5196C41.1265 61.5196 41.8088 61.4957 42.0655 60.8203L43.1614 61.2536C42.8444 62.0725 42.0896 62.6044 40.9695 62.6044C39.8494 62.6044 39.0916 62.0725 38.7746 61.2536L39.8706 60.8203Z"
						fill="black" />
					<path
						d="M49.7305 63.3906H54.4342V64.7414H51.3155V66.5883H52.4114C53.0213 66.5883 53.8123 66.684 54.4463 67.2398C54.9112 67.6493 55.2132 68.2649 55.2132 69.024C55.2132 69.5679 55.0441 70.061 54.7633 70.4585C54.1414 71.3281 53.13 71.4357 52.4235 71.4357H49.7305V63.3906ZM51.3155 70.0849H52.0733C53.3413 70.0849 53.5828 69.4932 53.5828 69.0359C53.5828 68.5279 53.3021 67.9391 52.0944 67.9391H51.3155V70.0849Z"
						fill="black" />
					<path
						d="M61.4769 69.7472H58.1981L57.4796 71.4357H55.7617L59.2609 63.3906H60.5048L63.904 71.4357H62.1985L61.4769 69.7472ZM61.015 68.4681L59.8587 65.5722L58.6993 68.4681H61.015Z"
						fill="black" />
					<path
						d="M66.6829 66.5007H70.1179V63.3867H71.7029V71.4318H70.1179V67.8486H66.6829V71.4318H65.0979V63.3867H66.6829V66.5007Z"
						fill="black" />
					<path
						d="M75.3819 66.7916L78.3679 63.3906H80.3659L76.9309 67.1053L80.5509 71.4357H78.4549L75.5659 67.8286L75.3819 68.0109V71.4357H73.7969V63.3906H75.3819V66.7916Z"
						fill="black" />
					<path
						d="M82.4 69.7109C82.938 69.7109 83.351 70.1204 83.351 70.6523C83.351 71.1843 82.938 71.5937 82.4 71.5937C81.863 71.5937 81.449 71.1843 81.449 70.6523C81.449 70.1204 81.863 69.7109 82.4 69.7109Z"
						fill="black" />
					<path
						d="M89.2859 63.3906H90.4299L92.5859 68.504L94.841 63.3906H95.988L97.3529 71.4357H95.7439L95.0129 66.4778L92.8299 71.4357H92.296L90.2129 66.4778L89.3829 71.4357H87.7729L89.2859 63.3906Z"
						fill="black" />
					<path
						d="M107.321 67.4178C107.321 69.8654 105.543 71.6167 102.983 71.6167C100.423 71.6167 98.645 69.8684 98.645 67.4178C98.645 64.9673 100.423 63.207 102.983 63.207C105.543 63.207 107.321 64.9673 107.321 67.4178ZM105.688 67.4178C105.688 65.7891 104.568 64.6296 102.983 64.6296C101.398 64.6296 100.278 65.7891 100.278 67.4178C100.278 69.0466 101.398 70.1912 102.983 70.1912C104.568 70.1912 105.688 69.0466 105.688 67.4178Z"
						fill="black" />
					<path
						d="M114.101 71.4348H112.516V68.3208H112.223L110.152 71.4348H108.25L110.662 68.1773C110.357 68.1295 110.028 67.995 109.772 67.8157C109.286 67.466 108.857 66.8026 108.857 65.8732C108.857 64.9915 109.234 64.3759 109.663 64.0024C110.297 63.4465 111.064 63.3867 111.746 63.3867H114.098V71.4348H114.101ZM112.027 64.6688C111.734 64.6688 110.493 64.6807 110.493 65.8762C110.493 67.0955 111.737 67.0955 112.054 67.0955H112.519V64.6718H112.027V64.6688Z"
						fill="black" />
					<path
						d="M120.858 66.7916L123.844 63.3906H125.843L122.407 67.1053L126.027 71.4357H123.932L121.043 67.8286L120.858 68.0109V71.4357H119.273V63.3906H120.858V66.7916Z"
						fill="black" />
					<path
						d="M129.637 63.3906C130.551 63.3906 131.185 63.4863 131.78 64.0063C132.438 64.586 132.607 65.369 132.607 65.9488C132.607 66.2626 132.559 67.1322 131.937 67.7449C131.487 68.1902 130.817 68.4562 129.878 68.4562H128.855V71.4357H127.27V63.3906H129.637ZM128.855 67.1053H129.501C129.806 67.1053 130.195 67.1053 130.536 66.8513C130.829 66.6212 130.974 66.2596 130.974 65.9099C130.974 65.4647 130.754 65.1628 130.524 64.9925C130.195 64.7624 129.781 64.7384 129.401 64.7384H128.855V67.1053Z"
						fill="black" />
					<path
						d="M138.313 69.7472H135.034L134.316 71.4357H132.598L136.097 63.3906H137.341L140.74 71.4357H139.034L138.313 69.7472ZM137.848 68.4681L136.689 65.5722L135.532 68.4681H137.848Z"
						fill="black" />
					<path
						d="M141.785 60.7852C142.174 60.7852 142.491 61.1946 142.491 61.6548C142.491 62.115 142.174 62.5245 141.785 62.5245C141.395 62.5245 141.078 62.115 141.078 61.6548C141.078 61.1946 141.395 60.7852 141.785 60.7852ZM143.515 63.3911V71.4362H141.929V63.3911H143.515ZM143.614 60.7852C144.004 60.7852 144.321 61.1946 144.321 61.6548C144.321 62.115 144.004 62.5245 143.614 62.5245C143.225 62.5245 142.908 62.115 142.908 61.6548C142.908 61.1946 143.222 60.7852 143.614 60.7852Z"
						fill="black" />
					<path
						d="M147.195 66.5007H150.634V63.3867H152.219V71.4318H150.634V67.8486H147.195V71.4318H145.613V63.3867H147.195V66.5007Z"
						fill="black" />
					<path
						d="M159.125 69.7472H155.847L155.128 71.4357H153.41L156.909 63.3906H158.15L161.55 71.4357H159.844L159.125 69.7472ZM158.66 68.4681L157.504 65.5722L156.345 68.4681H158.66Z"
						fill="black" />
					<path
						d="M29.966 14.7617C24.8274 14.7617 22.3125 18.33 22.3125 22.7291C22.3125 27.1282 24.8274 30.6964 29.966 30.6964C35.1045 30.6964 37.6194 27.1282 37.6194 22.7291C37.6194 18.33 35.1045 14.7617 29.966 14.7617ZM29.966 29.8148C26.9046 29.8148 25.5882 26.5424 25.5882 22.7321C25.5882 18.9217 26.8563 15.6882 29.9176 15.6882C32.979 15.6882 34.3467 18.9217 34.3467 22.7321C34.3467 26.5424 33.0304 29.8148 29.966 29.8148Z"
						fill="white" />
					<path
						d="M59.8657 29.2611V15.1523L56.8647 15.1583L56.8496 29.2611H52.2968V15.1583H49.2747L49.2717 29.2461H44.6403V17.1218C44.6403 16.1326 43.8221 15.1583 42.8138 15.1583H40.2656V15.8128C40.9389 15.8128 41.6122 16.4673 41.6122 17.1248V30.331H59.9322V34.231H61.2787L62.0908 29.2611H59.8657Z"
						fill="white" />
					<path
						d="M78.0521 29.0367C77.0201 27.6202 72.2501 15.17 72.2501 15.17L72.2531 15.1641H70.7641L63.7271 30.3337H65.3811L67.1351 26.4666H73.5991L74.8221 29.1353C75.1661 29.8645 75.6521 30.3427 76.8811 30.3427H78.7071V29.5298C78.5841 29.5298 78.2331 29.2848 78.0521 29.0367ZM67.618 25.3967L70.6581 18.3498L73.1641 25.3967H67.618Z"
						fill="white" />
					<path
						d="M126.748 29.0367C125.715 27.6202 120.945 15.17 120.945 15.17L120.948 15.1641H119.459L112.422 30.3337H114.076L115.83 26.4666H122.294L123.517 29.1353C123.861 29.8645 124.347 30.3427 125.576 30.3427H127.403V29.5298C127.282 29.5298 126.929 29.2848 126.748 29.0367ZM116.314 25.3967L119.354 18.3498L121.86 25.3967H116.314Z"
						fill="white" />
					<path
						d="M95.815 29.3659C95.35 29.3659 94.689 28.7383 94.275 27.8926C92.769 24.8055 89.121 15.1615 89.121 15.1615H89.118L87.621 15.1406L81.088 29.2643H80.176L80.976 34.2342H82.322V30.3342H93.662V34.2342H95.009L95.815 29.3659ZM87.545 18.4967L87.594 18.4937L91.002 27.779C91.374 28.6576 91.827 29.1388 92.421 29.3659H82.733L87.545 18.4967Z"
						fill="white" />
					<path
						d="M104.721 22.239H101.421V16.2291H107.477L107.48 20.0903H108.73L109.675 15.1622L97.043 15.1562V15.8227C97.716 15.8227 98.389 16.4772 98.389 17.1346V30.3379L104.721 30.3319C109.074 30.3319 110.137 28.0367 110.137 26.1451C110.137 24.1188 109.074 22.239 104.721 22.239ZM104.123 29.3427H101.421V23.309H104.15C106.49 23.309 107.148 24.7553 107.148 26.0703C107.148 27.2896 106.46 29.3427 104.123 29.3427Z"
						fill="white" />
					<path
						d="M139.824 15.1602V22.2399H133.934V17.1385C133.934 16.1494 132.914 15.1602 131.905 15.1602H129.43V15.8146C130.103 15.8146 130.776 16.4691 130.776 17.1266V30.3328H133.934V23.3098H139.824V30.3328H142.916V15.1602H139.824Z"
						fill="white" />
					<path
						d="M159.727 28.262C158.272 26.7797 154.247 22.3358 154.247 22.3358V22.2163L160.539 15.1514L158.546 15.1484L152.239 22.2133H151.219V17.1388C151.219 16.1496 150.199 15.1604 149.19 15.1604H146.926V15.8149C147.629 15.8149 148.272 16.4694 148.272 17.1268C148.272 20.4291 148.272 30.333 148.272 30.333H151.219V23.3997H152.092C152.801 24.2963 156.578 28.9195 156.578 28.9195C157.734 30.2404 159.09 30.5542 160.464 30.5542H161.683L161.692 29.7025C161.33 29.7025 160.581 29.1317 159.727 28.262Z"
						fill="white" />
				</svg>
			</a>
		</div>
	</header>
	<main class="main">
		<div class="container">
			<h1 class="h1">Підпис клієнта</h1>
			<section class="step-intro">
				<nav class="nav">
					<label for="inpDate">Дата народження</label>
					<duet-date-picker identifier="inpDate" class="datepicker-important"></duet-date-picker>
					<a class="btn disabled" id="downloadDoc" href="#">
						Завантажити договір
					</a>
					<button class="btn" id="btnManualSignature" disabled>Підписати договір</button>
				</nav>
			</section>

			<section class="step-manual-signature d-none">
				<div id="sketch">
					<canvas id="canvas"></canvas>
				</div>
				<div class="step-manual-signature__btn-group">
					<button class="btn" id="btnClear">Очистити</button>
					<a id="btnSave" class="btn" download="manualSignature.png" href="">Save</a>
				</div>
			</section>
		</div>
	</main>

	<script>
		const $picker = document.querySelector("duet-date-picker");
		const $downloadDoc = document.querySelector('#downloadDoc');
		const $btnManualSignature = document.querySelector('#btnManualSignature');
		const DATE_FORMAT = /^(\d{1,2})\.(\d{1,2})\.(\d{4})$/

		$picker.dateAdapter = {
			parse(value = "", createDate) {
				const matches = value.match(DATE_FORMAT)
				if (matches) {
					return createDate(matches[3], matches[2], matches[1])
				}
			},
			format(date) {
				const day = date.getDate() < 10 ? `0${date.getDate()}` : date.getDate();
				const month = (date.getMonth() + 1) < 10 ? `0${(date.getMonth() + 1)}` : date.getMonth() + 1;
				return `${day}.${month}.${date.getFullYear()}`
			},
		}
		$picker.min = (new Date().getFullYear() - 100) + new Date().toISOString().slice(4,10);
		$picker.max = (new Date().getFullYear() - 14) + new Date().toISOString().slice(4,10);
		$picker.firstDayOfWeek = 0;
		$picker.localization = {
			placeholder: "dd.MM.yyyy",
			dayNames: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Нд"],
			monthNames: ["Січень", "Лютий", "Березень", "Квітень", "Травень", "Червень", "Липень", "Серпень", "Вересень", "Жовтень", "Листопад", "Грудень"],
			monthNamesShort: ["Січ", "Лют", "Бер", "Квіт", "Трав", "Черв", "Лип", "Серп", "Вер", "Жовт", "Лист", "Груд"],
			locale: "uk-UA",
		}
		$picker.addEventListener("duetChange", function(event) {
			if (event.detail.value) {
				$downloadDoc.classList.remove("disabled");
			} else {
				$downloadDoc.classList.add("disabled");
			}
		});

		$downloadDoc.addEventListener('click', function (e) {
			alert("Завантажили ...");
			$btnManualSignature.removeAttribute("disabled");
		});

		$btnManualSignature.addEventListener('click', function (e) {
			document.querySelector('.step-intro').classList.add('d-none');
			document.querySelector('.step-manual-signature').classList.remove('d-none');
			manualSignatureInit();
		});

		function manualSignatureInit() {
			const $canvas = document.querySelector('#canvas');
			const $btnClear = document.querySelector('#btnClear');
			const $btnSave = document.querySelector('#btnSave');
			const $sketch = document.querySelector('#sketch');
			let ctx;

			canvasSizesInit();

			let mousePos = { x: 0, y: 0 };
			let lastPos = { x: 0, y: 0 };

			$canvas.addEventListener("mousedown", function (e) {
				$canvas.addEventListener('mousemove', onDraw, false);
			}, false);

			$canvas.addEventListener("mouseup", function () {
				$canvas.removeEventListener('mousemove', onDraw, false);
			}, false);

			$canvas.addEventListener('mousemove', function (e) {
				lastPos.x = mousePos.x;
				lastPos.y = mousePos.y;

				mousePos.x = e.pageX - this.offsetLeft;
				mousePos.y = e.pageY - this.offsetTop;
			}, false);

			$canvas.addEventListener("touchstart", function (e) {
				mousePos = getTouchPos($canvas, e);
				const touch = e.touches[0];
				const mouseEvent = new MouseEvent("mousedown", {
					clientX: touch.clientX,
					clientY: touch.clientY
				});
				$canvas.dispatchEvent(mouseEvent);
			}, false);

			$canvas.addEventListener("touchend", function (e) {
				const mouseEvent = new MouseEvent("mouseup", {});
				$canvas.dispatchEvent(mouseEvent);
			}, false);

			$canvas.addEventListener("touchmove", function (e) {
				const touch = e.touches[0];
				const mouseEvent = new MouseEvent("mousemove", {
					clientX: touch.clientX,
					clientY: touch.clientY
				});
				$canvas.dispatchEvent(mouseEvent);
			}, false);

			document.body.addEventListener("touchstart", function (e) {
				if (e.target === $canvas) {
					e.preventDefault();
				}
			}, false);
			document.body.addEventListener("touchend", function (e) {
				if (e.target === $canvas) {
					e.preventDefault();
				}
			}, false);
			document.body.addEventListener("touchmove", function (e) {
				if (e.target === $canvas) {
					e.preventDefault();
				}
			}, false);

			$btnClear.addEventListener('click', function (e) {
				ctx.clearRect(0, 0, $canvas.width, $canvas.height);
			});

			$btnSave.addEventListener('click', function (e) {
				e.target.href = $canvas.toDataURL("image/png");
			});

			window.addEventListener(
				"resize",
				function () {
					ctx.clearRect(0, 0, $canvas.width, $canvas.height);
					timerDecorator(canvasSizesInit, 1000);
				},
				true
			);

			function canvasSizesInit() {
				const sketchStyle = getComputedStyle($sketch);
				ctx = $canvas.getContext('2d');
				$canvas.width = parseInt(sketchStyle.getPropertyValue('width')) - parseInt(sketchStyle.getPropertyValue('border-left-width')) - parseInt(sketchStyle.getPropertyValue('border-right-width'));
				$canvas.height = parseInt(sketchStyle.getPropertyValue('height')) - parseInt(sketchStyle.getPropertyValue('border-top-width')) - parseInt(sketchStyle.getPropertyValue('border-bottom-width'));
				ctx.lineWidth = 4;
				ctx.lineJoin = 'round';
				ctx.lineCap = 'round';
				ctx.strokeStyle = '#424242';
			}

			function onDraw(e) {
				ctx.beginPath();
				ctx.moveTo(lastPos.x, lastPos.y);
				ctx.lineTo(mousePos.x, mousePos.y);
				ctx.closePath();
				ctx.stroke();
			}

			function getTouchPos(canvasDom, touchEvent) {
				const rect = canvasDom.getBoundingClientRect();
				return {
					x: touchEvent.touches[0].clientX - rect.left,
					y: touchEvent.touches[0].clientY - rect.top
				};
			}

			const timerDecorator = (function () {
				const timers = {};
				return function (callback, ms, uniqueId) {
					if (!uniqueId) {
						uniqueId = "Don't call this twice without a uniqueId";
					}
					if (timers[uniqueId]) {
						clearTimeout(timers[uniqueId]);
					}
					timers[uniqueId] = setTimeout(callback, ms);
				};
			})();
		}
	</script>
</body>

</html>